(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{"4sOm":function(t,n,i){"use strict";i.r(n),i.d(n,"NotificationsPageModule",(function(){return w}));var o=i("ofXK"),e=i("3Pt+"),c=i("tyNb"),a=i("TEn/"),r=i("mrSG"),s=i("wd/R"),f=i("fXoL"),u=i("ri4K"),p=i("AytR"),b=i("2Vo4"),l=i("tk/3"),g=i("e8h1"),h=function(){function t(t,n){this.http=t,this.storage=n,this.notificationsState=new b.a(!1)}return t.prototype.monitorNotifications=function(){return this.notificationsState.asObservable()},t.prototype.notificationsUpdated=function(){this.notificationsState.next(!0)},t.prototype.getNotifications=function(t){var n=this;return new Promise((function(i,o){n.storage.get("foodie_token").then((function(e){e?n.http.get(p.a.apiUrl+"/notifications?token="+e+"&page="+t.page+"&limit="+t.limit).subscribe((function(t){i(t)}),(function(t){o(t)})):o()}))}))},t.prototype.getNotificationCount=function(){var t=this;return new Promise((function(n,i){t.storage.get("foodie_token").then((function(o){o?t.http.get(p.a.apiUrl+"/notificationcount?token="+o).subscribe((function(t){n(t)}),(function(t){i(t)})):i()}))}))},t.prototype.markAllAsSeen=function(){var t=this;return new Promise((function(n,i){t.storage.get("foodie_token").then((function(o){o?t.http.get(p.a.apiUrl+"/notificationsseen?token="+o).subscribe((function(i){t.notificationsState.next(!0),n(i)}),(function(t){i(t)})):i()}))}))},t.prototype.updateNotification=function(t){var n=this;return new Promise((function(i,o){n.storage.get("foodie_token").then((function(e){e?n.http.put(p.a.apiUrl+"/notifications/"+t.id+"?token="+e,t).subscribe((function(t){n.notificationsState.next(!0),i(t)}),(function(t){o(t)})):o()}))}))},t.\u0275fac=function(n){return new(n||t)(f.Ob(l.a),f.Ob(g.b))},t.\u0275prov=f.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t}();function d(t,n){1&t&&(f.Kb(0,"div",9),f.Ib(1,"ion-spinner",0),f.Jb())}function _(t,n){1&t&&(f.Kb(0,"div",10),f.Ib(1,"ion-icon",11),f.Kb(2,"h2"),f.gc(3,"No Notifications"),f.Jb(),f.Jb())}var m=function(t){return{"notifications__notifications-list--not-seen":t}};function v(t,n){if(1&t){var i=f.Lb();f.Kb(0,"ion-item",12),f.Sb("click",(function(){f.cc(i);var t=n.$implicit;return f.Ub().openNotification(t)})),f.Kb(1,"ion-label"),f.Kb(2,"h2"),f.gc(3),f.Kb(4,"ion-note"),f.gc(5),f.Jb(),f.Jb(),f.Kb(6,"p"),f.gc(7),f.Jb(),f.Jb(),f.Jb()}if(2&t){var o=n.$implicit,e=f.Ub();f.Xb("ngClass",f.Zb(4,m,!o.seen)),f.xb(3),f.ic(" ",o.heading," "),f.xb(2),f.hc(e.formatDate(o.created_at)),f.xb(2),f.ic(" ",o.content," ")}}var y=[{path:"",component:function(){function t(t,n,i,o){this.authenticationService=t,this.notificationsService=n,this.alertController=i,this.navController=o,this.notifications={data:[],count:0},this.page=1,this.loading=!0}return t.prototype.ngOnInit=function(){},t.prototype.ionViewDidEnter=function(){this.notifications={data:[],count:0},this.page=1,this.loading=!0,this.getNotifications(),this.markAllAsSeen()},t.prototype.getNotifications=function(){var t=this;console.log("getting"),this.notificationsService.getNotifications({limit:10,page:this.page}).then((function(n){t.notifications=n,t.loading=!1})).catch((function(n){console.log(n),t.loading=!1}))},t.prototype.getMoreNotifications=function(t){var n=this;this.page=this.page+1,this.notificationsService.getNotifications({limit:10,page:this.page}).then((function(i){var o,e;try{for(var c=Object(r.d)(i.data),a=c.next();!a.done;a=c.next())n.notifications.data.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(e=c.return)&&e.call(c)}finally{if(o)throw o.error}}t.complete()})).catch((function(n){t.complete()}))},t.prototype.markAllAsSeen=function(){this.notificationsService.markAllAsSeen().then((function(){}))},t.prototype.openNotification=function(t){t.seen||(t.seen=!0,this.notificationsService.updateNotification({seen:!0,id:t.id}).then((function(){}))),"review"===t.notification_type||"location"===t.notification_type?this.navController.navigateForward("/location/"+t.source_id):"profile"===t.notification_type?this.navController.navigateForward("/profile"):this.viewNotification(t)},t.prototype.viewNotification=function(t){return Object(r.a)(this,void 0,void 0,(function(){return Object(r.c)(this,(function(n){switch(n.label){case 0:return[4,this.alertController.create({header:t.heading,subHeader:"Created "+this.formatDate(t.created_at),message:t.content,buttons:["Dismiss"]})];case 1:return[4,n.sent().present()];case 2:return n.sent(),[2]}}))}))},t.prototype.formatDate=function(t){return s(t).fromNow()},t.\u0275fac=function(n){return new(n||t)(f.Hb(u.a),f.Hb(h),f.Hb(a.a),f.Hb(a.L))},t.\u0275cmp=f.Bb({type:t,selectors:[["app-notifications"]],decls:14,vars:3,consts:[["color","primary"],["slot","start"],["defaultHref","/tabs/browse"],[1,"notifications"],["class","notifications__loading",4,"ngIf"],["class","notifications__empty",4,"ngIf"],[1,"notifications__notifications-list"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ionInfinite"],[1,"notifications__loading"],[1,"notifications__empty"],["name","notifications"],[3,"ngClass","click"]],template:function(t,n){1&t&&(f.Kb(0,"ion-header"),f.Kb(1,"ion-toolbar",0),f.Kb(2,"ion-buttons",1),f.Kb(3,"ion-button"),f.Ib(4,"ion-back-button",2),f.Jb(),f.Jb(),f.Kb(5,"ion-title"),f.gc(6,"Notifications"),f.Jb(),f.Jb(),f.Jb(),f.Kb(7,"ion-content",3),f.fc(8,d,2,0,"div",4),f.fc(9,_,4,0,"div",5),f.Kb(10,"ion-list",6),f.fc(11,v,8,6,"ion-item",7),f.Jb(),f.Kb(12,"ion-infinite-scroll",8),f.Sb("ionInfinite",(function(t){return n.getMoreNotifications(t)})),f.Ib(13,"ion-infinite-scroll-content"),f.Jb(),f.Jb()),2&t&&(f.xb(8),f.Xb("ngIf",n.loading),f.xb(1),f.Xb("ngIf",n.notifications.data.length<1&&!n.loading),f.xb(2),f.Xb("ngForOf",n.notifications.data))},directives:[a.k,a.G,a.h,a.g,a.e,a.f,a.F,a.i,o.j,a.r,o.i,a.m,a.n,a.A,a.l,a.p,o.h,a.q,a.t],styles:[".notifications[_ngcontent-%COMP%]   .notifications__notifications-list--not-seen[_ngcontent-%COMP%]{--background:#ecf9f1}.notifications[_ngcontent-%COMP%]   .notifications__loading[_ngcontent-%COMP%]{text-align:center;margin-top:60px}.notifications[_ngcontent-%COMP%]   .notifications__empty[_ngcontent-%COMP%]{text-align:center;opacity:.2;padding-top:60px;padding-bottom:60px}.notifications[_ngcontent-%COMP%]   .notifications__empty[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:60px}.notifications[_ngcontent-%COMP%]   .notifications__empty[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:5px 0 0;font-size:22px}"]}),t}()}],w=function(){function t(){}return t.\u0275mod=f.Fb({type:t}),t.\u0275inj=f.Eb({factory:function(n){return new(n||t)},imports:[[o.b,e.a,a.H,c.j.forChild(y)]]}),t}()}}]);